doctype html
head
  meta(charset='utf-8')
  title Metronic | Login Page - 5
  meta(name='description' content='Latest updates and statistic charts')
  meta(name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no')
  // begin::Web font
  script(src='https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js')
  script.
    WebFont.load({
    google: {"families":["Poppins:300,400,500,600,700","Roboto:300,400,500,600,700"]},
    active: function() {
    sessionStorage.fonts = true;
    }
    });
  // end::Web font
  // begin:: Global Mandatory Vendors
  link(href='/vendors/perfect-scrollbar/css/perfect-scrollbar.css' rel='stylesheet' type='text/css')
  // end:: Global Mandatory Vendors
  // begin:: Global Optional Vendors
  link(href='/vendors/tether/dist/css/tether.css' rel='stylesheet' type='text/css')
  link(href='/vendors/bootstrap-datepicker/dist/css/bootstrap-datepicker3.min.css' rel='stylesheet' type='text/css')
  link(href='/vendors/bootstrap-datetime-picker/css/bootstrap-datetimepicker.min.css' rel='stylesheet' type='text/css')
  link(href='/vendors/bootstrap-timepicker/css/bootstrap-timepicker.min.css' rel='stylesheet' type='text/css')
  link(href='/vendors/bootstrap-daterangepicker/daterangepicker.css' rel='stylesheet' type='text/css')
  link(href='/vendors/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.css' rel='stylesheet' type='text/css')
  link(href='/vendors/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.css' rel='stylesheet' type='text/css')
  link(href='/vendors/bootstrap-select/dist/css/bootstrap-select.css' rel='stylesheet' type='text/css')
  link(href='/vendors/select2/dist/css/select2.css' rel='stylesheet' type='text/css')
  link(href='/vendors/nouislider/distribute/nouislider.css' rel='stylesheet' type='text/css')
  link(href='/vendors/owl.carousel/dist/assets/owl.carousel.css' rel='stylesheet' type='text/css')
  link(href='/vendors/owl.carousel/dist/assets/owl.theme.default.css' rel='stylesheet' type='text/css')
  link(href='/vendors/ion-rangeslider/css/ion.rangeSlider.css' rel='stylesheet' type='text/css')
  link(href='/vendors/ion-rangeslider/css/ion.rangeSlider.skinFlat.css' rel='stylesheet' type='text/css')
  link(href='/vendors/dropzone/dist/dropzone.css' rel='stylesheet' type='text/css')
  link(href='/vendors/summernote/dist/summernote.css' rel='stylesheet' type='text/css')
  link(href='/vendors/bootstrap-markdown/css/bootstrap-markdown.min.css' rel='stylesheet' type='text/css')
  link(href='/vendors/animate.css/animate.css' rel='stylesheet' type='text/css')
  link(href='/vendors/toastr/build/toastr.css' rel='stylesheet' type='text/css')
  link(href='/vendors/jstree/dist/themes/default/style.css' rel='stylesheet' type='text/css')
  link(href='/vendors/morris.js/morris.css' rel='stylesheet' type='text/css')
  link(href='/vendors/chartist/dist/chartist.min.css' rel='stylesheet' type='text/css')
  link(href='/vendors/socicon/css/socicon.css' rel='stylesheet' type='text/css')
  link(href='/vendors/vendors/line-awesome/css/line-awesome.css' rel='stylesheet' type='text/css')
  link(href='/vendors/vendors/flaticon/css/flaticon.css' rel='stylesheet' type='text/css')
  link(href='/vendors/vendors/metronic/css/styles.css' rel='stylesheet' type='text/css')
  link(href='/vendors/vendors/fontawesome5/css/all.min.css' rel='stylesheet' type='text/css')
  link(href='/assets/vendors/custom/dropify.css' rel='stylesheet' type='text/css')
  link(href='/assets/vendors/custom/formValidation.css' rel='stylesheet' type='text/css')
  
  // end:: Global Optional Vendors
  // begin::Global Theme Styles
  link(href='/assets/demo/base/style.bundle.css' rel='stylesheet' type='text/css')
  // RTL version:<link href="../../../assets/demo/base/style.bundle.rtl.css" rel="stylesheet" type="text/css" />
  // end::Global Theme Styles
  link(rel='shortcut icon' href='/assets/demo/media/img/logo/favicon.ico')
  style.
    .help-block{
      color: red;
    }
    .form-control-feedback{
      top: 21%;
      position: absolute;
      left: 398px;
      color: red;
    }
// end::Head
// begin::Body
// begin:: Page
.m-grid.m-grid--hor.m-grid--root.m-page
  #m_login.m-login.m-login--signin.m-login--5(style='background-image: url(../../../assets/app/media/img//bg/bg-3.jpg);')
    .m-login__wrapper-1.m-portlet-full-height(style="width: 30%")
      .m-login__wrapper-1-1
        .m-login__contanier
          .m-login__content
            .m-login__logo
              a(href='#')
                img(src='/assets/app/media/img/logos/logo-2.png')
            .m-login__title
              h3 WE ARE HIRING SKILLED TECHNICIANS. JOIN US NOW!
            .m-login__desc
             | Click here for 
             a Job Description
            .m-login__form-action
              button#m_login_signup.btn.btn-outline-focus.m-btn--pill(type='button') Apply Here!
        .m-login__border
          div
    .m-login__wrapper-2.m-portlet-full-height
      .m-login__contanier(style="width: 90%")
        .m-login__signin
          .m-login__head
            h3.m-login__title Login To Your Account
          form.m-login__form.m-form(action='')
            .form-group.m-form__group
              input.form-control.m-input(type='text' placeholder='Username' name='username' autocomplete='off')
            .form-group.m-form__group
              input.form-control.m-input.m-login__form-input--last(type='Password' placeholder='Password' name='password')
            .row.m-login__form-sub
              .col.m--align-left
                label.m-checkbox.m-checkbox--focus
                  input(type='checkbox' name='remember')
                  |  Remember me
                  span
              .col.m--align-right
                a#m_login_forget_password.m-link(href='javascript:;') Forget Password ?
            .m-login__form-action
              button#m_login_signin_submit.btn.btn-focus.m-btn.m-btn--pill.m-btn--custom.m-btn--air Sign In
        #technicianForm.m-login__signup
          .m-portlet
            .m-portlet__head
              .m-portlet__head-caption
                .m-portlet__head-title
                  h3.m-portlet__head-text
                    | Technician Application
            .m-portlet__body
              .form-group.m-form__group.row
                label.col-form-label.col-lg-3.col-sm-12 Upload Your CV
                .col-lg-9.col-md-9.col-sm-12
                 input#resumeLetter.dropify(type='file', name='resumeLetter' data-height='300' accept="pdf/*" data-allowed-file-extensions="pdf")
              .form-group.m-form__group.row
                label.col-lg-3.col-form-label.col-sm-12(for='example-text-input') First name
                .col-lg-9.col-md-9.col-sm-12
                  .input-group
                    input#firstName.form-control.m-input(type='text' name="firstName" placeholder='E.g. Ariana' aria-describedby='basic-addon2')
                    .input-group-append
                      span#basic-addon2.input-group-text
                        i.fa.fa-user
              .form-group.m-form__group.row
                label.col-lg-3.col-form-label.col-sm-12(for='example-text-input') Last name
                .col-lg-9.col-md-9.col-sm-12
                  .input-group
                    input#lastName.form-control.m-input(type='text' name="lastName" placeholder='E.g. Grande' aria-describedby='basic-addon2')
                    .input-group-append
                      span#basic-addon2.input-group-text
                        i.fa.fa-user
              .form-group.m-form__group.row
                label.col-form-label.col-lg-3.col-sm-12 Email
                .col-lg-9.col-md-9.col-sm-12
                  .input-group
                    input#emailAddress.form-control.m-input(type='text' name="emailAddress" placeholder='arianagrande@email.com' aria-describedby='basic-addon2')
                    .input-group-append
                      span#basic-addon2.input-group-text @
              .form-group.m-form__group.row
                label.col-form-label.col-lg-3.col-sm-12 Birthdate
                .col-lg-9.col-md-9.col-sm-12
                  .input-group.date
                    input#birthDate.form-control.m-input(type='text' name="birthDate" readonly='' value='05/20/2017')
                    .input-group-append
                      span.input-group-text
                        i.la.la-calendar

              .form-group.m-form__group.row
                label.col-form-label.col-lg-3.col-sm-12 Gender
                .col-lg-9.col-md-9.col-sm-12
                  .m-radio-inline
                    label.m-radio
                      input(type='radio' name='gender' value='Male')
                      |  Male
                      span
                    label.m-radio
                      input(type='radio' name='gender' value='Female')
                      |  Female
                      span
              .form-group.m-form__group.row
                label.col-3.col-form-label(for='exampleTextarea') Cover Letter
                .col-9
                  textarea#coverLetter.form-control.m-input.m-input--air(name="coverLetter" placeholder='Tell me a little bit about yourself. This is optional' rows='3' style='margin-top: 0px; margin-bottom: 0px; height: 164px;')
            .m-portlet__foot
              .m-login__form-action
                button#applyButton.btn.btn-focus.m-btn.m-btn--pill.m-btn--custom.m-btn--air Apply
                button#m_login_signup_cancel.btn.btn-outline-focus.m-btn.m-btn--pill.m-btn--custom Cancel
        .m-login__forget-password
          .m-login__head
            h3.m-login__title Forgotten Password ?
            .m-login__desc Enter your email to reset your password:
          form.m-login__form.m-form(action='')
            .form-group.m-form__group
              input#m_email.form-control.m-input(type='text' placeholder='Email' name='email' autocomplete='off')
            .m-login__form-action
              button#m_login_forget_password_submit.btn.btn-focus.m-btn.m-btn--pill.m-btn--custom.m-btn--air Request
              button#m_login_forget_password_cancel.btn.btn-outline-focus.m-btn.m-btn--pill.m-btn--custom Cancel
        #errorfield(type='text', value=0)
// end:: Page
// begin:: Global Mandatory Vendors
script(src='/vendors/jquery/dist/jquery.js' type='text/javascript')
script(src='/vendors/popper.js/dist/umd/popper.js' type='text/javascript')
script(src='/vendors/bootstrap/dist/js/bootstrap.min.js' type='text/javascript')
script(src='/vendors/js-cookie/src/js.cookie.js' type='text/javascript')
script(src='/vendors/moment/min/moment.min.js' type='text/javascript')
script(src='/vendors/tooltip.js/dist/umd/tooltip.min.js' type='text/javascript')
script(src='/vendors/perfect-scrollbar/dist/perfect-scrollbar.js' type='text/javascript')
script(src='/vendors/wnumb/wNumb.js' type='text/javascript')
// end:: Global Mandatory Vendors
// begin:: Global Optional Vendors
script(src='/vendors/jquery.repeater/src/lib.js' type='text/javascript')
script(src='/vendors/jquery.repeater/src/jquery.input.js' type='text/javascript')
script(src='/vendors/jquery.repeater/src/repeater.js' type='text/javascript')
script(src='/vendors/jquery-form/dist/jquery.form.min.js' type='text/javascript')
script(src='/vendors/block-ui/jquery.blockUI.js' type='text/javascript')
script(src='/vendors/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js' type='text/javascript')
script(src='/vendors/js/framework/components/plugins/forms/bootstrap-datepicker.init.js' type='text/javascript')
script(src='/vendors/bootstrap-datetime-picker/js/bootstrap-datetimepicker.min.js' type='text/javascript')
script(src='/vendors/bootstrap-timepicker/js/bootstrap-timepicker.min.js' type='text/javascript')
script(src='/vendors/js/framework/components/plugins/forms/bootstrap-timepicker.init.js' type='text/javascript')
script(src='/vendors/bootstrap-daterangepicker/daterangepicker.js' type='text/javascript')
script(src='/vendors/js/framework/components/plugins/forms/bootstrap-daterangepicker.init.js' type='text/javascript')
script(src='/vendors/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.js' type='text/javascript')
script(src='/vendors/bootstrap-maxlength/src/bootstrap-maxlength.js' type='text/javascript')
script(src='/vendors/bootstrap-switch/dist/js/bootstrap-switch.js' type='text/javascript')
script(src='/vendors/js/framework/components/plugins/forms/bootstrap-switch.init.js' type='text/javascript')
script(src='/vendors/vendors/bootstrap-multiselectsplitter/bootstrap-multiselectsplitter.min.js' type='text/javascript')
script(src='/vendors/bootstrap-select/dist/js/bootstrap-select.js' type='text/javascript')
script(src='/vendors/select2/dist/js/select2.full.js' type='text/javascript')
script(src='/vendors/typeahead.js/dist/typeahead.bundle.js' type='text/javascript')
script(src='/vendors/handlebars/dist/handlebars.js' type='text/javascript')
script(src='/vendors/inputmask/dist/jquery.inputmask.bundle.js' type='text/javascript')
script(src='/vendors/inputmask/dist/inputmask/inputmask.date.extensions.js' type='text/javascript')
script(src='/vendors/inputmask/dist/inputmask/inputmask.numeric.extensions.js' type='text/javascript')
script(src='/vendors/inputmask/dist/inputmask/inputmask.phone.extensions.js' type='text/javascript')
script(src='/vendors/nouislider/distribute/nouislider.js' type='text/javascript')
script(src='/vendors/owl.carousel/dist/owl.carousel.js' type='text/javascript')
script(src='/vendors/autosize/dist/autosize.js' type='text/javascript')
script(src='/vendors/clipboard/dist/clipboard.min.js' type='text/javascript')
script(src='/vendors/ion-rangeslider/js/ion.rangeSlider.js' type='text/javascript')
script(src='/vendors/dropzone/dist/dropzone.js' type='text/javascript')
script(src='/vendors/summernote/dist/summernote.js' type='text/javascript')
script(src='/vendors/markdown/lib/markdown.js' type='text/javascript')
script(src='/vendors/bootstrap-markdown/js/bootstrap-markdown.js' type='text/javascript')
script(src='/vendors/js/framework/components/plugins/forms/bootstrap-markdown.init.js' type='text/javascript')
script(src='/vendors/jquery-validation/dist/jquery.validate.js' type='text/javascript')
script(src='/vendors/jquery-validation/dist/additional-methods.js' type='text/javascript')
script(src='/vendors/js/framework/components/plugins/forms/jquery-validation.init.js' type='text/javascript')
script(src='/vendors/bootstrap-notify/bootstrap-notify.min.js' type='text/javascript')
script(src='/vendors/js/framework/components/plugins/base/bootstrap-notify.init.js' type='text/javascript')
script(src='/vendors/toastr/build/toastr.min.js' type='text/javascript')
script(src='/vendors/jstree/dist/jstree.js' type='text/javascript')
script(src='/vendors/raphael/raphael.js' type='text/javascript')
script(src='/vendors/morris.js/morris.js' type='text/javascript')
script(src='/vendors/chartist/dist/chartist.js' type='text/javascript')
script(src='/vendors/chart.js/dist/Chart.bundle.js' type='text/javascript')
script(src='/vendors/js/framework/components/plugins/charts/chart.init.js' type='text/javascript')
script(src='/vendors/vendors/bootstrap-session-timeout/dist/bootstrap-session-timeout.min.js' type='text/javascript')
script(src='/vendors/vendors/jquery-idletimer/idle-timer.min.js' type='text/javascript')
script(src='/vendors/waypoints/lib/jquery.waypoints.js' type='text/javascript')
script(src='/vendors/counterup/jquery.counterup.js' type='text/javascript')
script(src='/vendors/es6-promise-polyfill/promise.min.js' type='text/javascript')
// end:: Global Optional Vendors
// begin::Global Theme Bundle
script(src='/assets/demo/base/scripts.bundle.js' type='text/javascript')
// end::Global Theme Bundle
// begin::Page Scripts
script(src='/assets/snippets/custom/pages/user/login.js' type='text/javascript')
script(src='/assets/vendors/custom/dropify.js' type='text/javascript')
script(src='/assets/vendors/custom/jquery.form.js' type='text/javascript')
script(src='/assets/vendors/custom/sweetalert.js' type='text/javascript')
script(src='/assets/vendors/custom/formValidation.js' type='text/javascript')
script(src='/assets/vendors/custom/bootstrapValidation.js' type='text/javascript')
script(src='/default/assets/demo/custom/crud/forms/widgets/bootstrap-datepicker.js' type='text/javascript')
script.
  $(document).ready(function(){

   //Initializations of extensions.
   $('#resumeLetter').dropify({
    allowedFiles: ['pdf'],
    messages: {
     'default': 'Drag and drop your Resume/CV here or click. File should be in PDF.',
     'replace': 'Drag and drop or click to replace',
     'remove': 'Remove',
     'error': 'Ooops, you can only upload PDF Files.'
    },
    error: {
     'fileFormat': 'The file format is not allowed ({{ value }} only).'
    }
   });

   $('#technicianForm').formValidation({
      framework: 'bootstrap',
      icon: {
        valid: 'fa fa-check',
        invalid: 'fa fa-times',
        validating: 'fa fa-spinner'
      },
      fields: {
        firstName: {
          validators: {
            notEmpty: {
              message: 'What is your first name?',
            },
          },
        },
        lastName: {
          validators: {
            notEmpty: {
              message: 'What is your last name?',
            },
          },
        },
        birthDate: {
          validators: {
            notEmpty: {
              message: 'When is your birthdate?',
            },
          },
        },
        gender: {
          validators: {
            notEmpty: {
              message: 'What is your gender?',
            },
          },
        },
        emailAddress: {
          validators: {
            
            notEmpty: {
              message: 'Enter your e-mail address'
            },
            emailAddress: {
              message: 'This is not a valid e-mail address.'
            },
            //- remote: {
            //-   url: '/emailavailability',
            //-   message: 'E-mail address has been taken',
            //-   validKey: 'email',
            //-   type: 'POST'
            //- },
          }
        },
        

        //- username: {
        //-   validators: {
            
        //-     notEmpty: {
        //-       message: `Enter your desired username. You'll use this to sign in to your account.`									
        //-     },
        //-     stringLength: {
        //-       min: 6,
        //-       max: 30,
        //-       message: 'The username must be minimum of 6 characters and maximum of 30 characters.'
        //-     },
        //-     regexp: {
        //-       regexp: /^[a-zA-Z0-9_\.]+$/,
        //-       message: 'The username can only consist of alphabetical, number, dot and underscore'
        //-     },
        //-     remote: {
        //-       url: '/usernameavailability',
        //-       message: 'Username has been taken',
        //-       validKey: 'username',
        //-       type: 'POST'
        //-     },
        //-   }
        //- },
      }
    })
    .on('err.field.fv', function(e, data) {
      // Get the first invalid field
      var invalidFields = data.fv.getInvalidFields().length;
      $('#errorfield').val(invalidFields)
    })
    .on('success.field.fv', function(e, data) {
      // Get the first invalid field
      var invalidFields = data.fv.getInvalidFields().length;
      $('#errorfield').val(invalidFields)
    });


   $(document).on('click', '#applyButton', function(){
    $('#technicianForm').data('formValidation').validate();
    var errorField = $('#errorfield').val();
    var birthDate = $('#birthDate').val();
    var resumeLetter = $('#resumeLetter')[0].files[0];
    if(errorField == 0){
      console.log(resumeLetter);
      console.log(birthDate)
      if(resumeLetter == undefined || birthDate == "" ){
        swal({
          title: 'Uh-oh!',
          text: 'Fill-out all the forms.',
          icon: 'error',
          button: 'Okay',
        })
      }
      else{
        var formData = new FormData();

        formData.append('resumeLetter', $('#resumeLetter')[0].files[0]);
        formData.append('firstName', $('#firstName').val());
        formData.append('lastName', $('#lastName').val());
        formData.append('emailAddress', $('#emailAddress').val());
        formData.append('birthDate', $('#birthDate').val());
        formData.append('gender', $("input[name='gender']:checked").val());
        formData.append('coverLetter', $("#coverLetter").val());


        $.ajax({
        type: "POST",
        url: "/apply",
        data: formData,
        processData: false,
        contentType: false,
        success: function(data){
          console.log(data.message)
          if(data.message === "Success"){
            //- Clear Dropify
            $('.dropify-clear').trigger('click');
            $('input').val('');
            $('textarea').val('');
            $('#gender').prop('checked', false);

            //Destroy the validation
            $('#technicianForm').formValidation('destroy');
            $('#technicianForm').formValidation({
              framework: 'bootstrap',
              icon: {
                valid: 'fa fa-check',
                invalid: 'fa fa-times',
                validating: 'fa fa-spinner'
              },
              fields: {
                firstName: {
                  validators: {
                    notEmpty: {
                      message: 'What is your first name?',
                    },
                  },
                },
                lastName: {
                  validators: {
                    notEmpty: {
                      message: 'What is your last name?',
                    },
                  },
                },
                birthDate: {
                  validators: {
                    notEmpty: {
                      message: 'When is your birthdate?',
                    },
                  },
                },
                gender: {
                  validators: {
                    notEmpty: {
                      message: 'What is your gender?',
                    },
                  },
                },
                emailAddress: {
                  validators: {
                    
                    notEmpty: {
                      message: 'Enter your e-mail address'
                    },
                    emailAddress: {
                      message: 'This is not a valid e-mail address.'
                    },
                  }
                },
              }
            })
            .on('err.field.fv', function(e, data) {
              // Get the first invalid field
              var invalidFields = data.fv.getInvalidFields().length;
              $('#errorfield').val(invalidFields)
            })
            .on('success.field.fv', function(e, data) {
              // Get the first invalid field
              var invalidFields = data.fv.getInvalidFields().length;
              $('#errorfield').val(invalidFields)
            });

            swal({
              title: 'Success!',
              text: 'Your application has been successfully submitted.',
              icon: 'success',
              button: 'Okay',
            })
          }
          else if(data.message == "Duplicate"){
            swal({
              title: 'E-mail address has been already taken.',
              text: 'Please use another e-mail address.',
              icon: 'error',
              button: 'Okay',
            })
          }
          else{
            swal({
              title: 'Uh-oh!',
              text: 'Your application has not been submitted. Please try again!',
              icon: 'error',
              button: 'Okay',
            })
          }
        },
        error: function (e) {
          swal({
              title: 'Uh-oh!',
              text: 'Your application has not been submitted. Please try again!',
              icon: 'error',
              button: 'Okay',
            })
        }
        });
      }
    }
    else{
      alert('Wow balik')
    }
   })
  });
